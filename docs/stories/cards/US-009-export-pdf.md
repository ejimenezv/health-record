# User Story US-009: Export Medical Record to PDF

## Story Card

**As a** doctor
**I want to** export an appointment's medical record to PDF
**So that** I can print it for the patient or share it with other healthcare providers

---

## Description

The doctor needs to generate a professional PDF document containing the complete medical record for a specific appointment. The PDF includes patient demographics, appointment details, vital signs (if recorded), chief complaint, symptoms, diagnosis, prescriptions, and treatment plan. The document should be printable and suitable for sharing.

This feature enables physical documentation and facilitates communication with other healthcare providers.

---

## Acceptance Criteria

- [ ] Given I am viewing a completed appointment, when I click "Export to PDF", then a PDF is generated
- [ ] Given a PDF is generated, when I view it, then it includes the patient's name, date of birth, and contact information
- [ ] Given a PDF is generated, when I view it, then it includes appointment date, type, and reason for visit
- [ ] Given vital signs were recorded, when I view the PDF, then they are included in the document
- [ ] Given symptoms were recorded, when I view the PDF, then all symptoms are listed with their details
- [ ] Given a diagnosis was entered, when I view the PDF, then it is prominently displayed
- [ ] Given prescriptions were added, when I view the PDF, then each prescription shows all details (medication, dosage, frequency, instructions)
- [ ] Given the PDF is generated, when I view it, then it has professional formatting suitable for printing
- [ ] Given the PDF is generated, when generation completes, then it downloads automatically or opens in new tab
- [ ] Given a PDF is generated, when I view it, then it includes a footer with generation date and "Generated by MedRecord AI"
- [ ] Given PDF generation fails, when an error occurs, then I see an error message and can retry

---

## Priority

**Should-Have (P1)**

---

## Story Points

**3 points**

Rationale: Standard PDF generation with template formatting.

---

## Dependencies

| Dependency | Type | Story |
|------------|------|-------|
| Manual Record Entry | Required | US-005 |
| View Medical History | Required | US-003 |

---

## Technical Notes

### PDF Content Structure

```typescript
interface PDFContent {
  // Header
  clinicInfo?: {
    name: string;
    address: string;
    phone: string;
    logo?: string;
  };

  // Patient Info
  patient: {
    fullName: string;
    dateOfBirth: string;
    age: number;
    phone: string;
    email?: string;
  };

  // Appointment Info
  appointment: {
    date: string;
    type: string;
    reason: string;
    provider: string;
  };

  // Clinical Content
  vitalSigns?: VitalSigns;
  chiefComplaint?: string;
  symptoms: Symptom[];
  diagnosis: string;
  diagnosisNotes?: string;
  prescriptions: Prescription[];
  treatmentPlan?: string;
  followUpInstructions?: string;

  // Footer
  generatedAt: string;
  recordId: string;
}
```

### Implementation Options

1. **Server-side generation (recommended)**
   - Use puppeteer or playwright to render HTML to PDF
   - Consistent formatting across all clients
   - Can include custom fonts and styling

2. **Client-side generation**
   - Use jsPDF or react-pdf
   - Faster, no server round-trip
   - More limited styling options

3. **PDF template service**
   - Use service like DocSpring or PDF.co
   - Easiest to implement professional templates
   - Additional cost

### API Endpoints

```
GET /api/appointments/:id/pdf           - Generate and download PDF
POST /api/appointments/:id/pdf/preview  - Generate preview (optional)
```

### Response

```
Content-Type: application/pdf
Content-Disposition: attachment; filename="MartinezAna_2026-02-21_MedicalRecord.pdf"
```

---

## UI/UX Notes

### PDF Layout Template

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MEDRECORD AI                    Dr. Smith's Clinic     â”‚   â”‚
â”‚  â”‚  Medical Record                  123 Medical Center Dr  â”‚   â”‚
â”‚  â”‚                                  Phone: (555) 000-0000  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                  â”‚
â”‚  PATIENT INFORMATION                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Name: Ana Martinez                   Date of Birth: 03/15/1981 â”‚
â”‚  Age: 45 years                        Phone: (555) 123-4567    â”‚
â”‚                                                                  â”‚
â”‚  APPOINTMENT DETAILS                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Date: February 21, 2026              Type: Follow-up          â”‚
â”‚  Provider: Dr. John Smith             Reason: Headache follow-upâ”‚
â”‚                                                                  â”‚
â”‚  VITAL SIGNS                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Blood Pressure: 120/80 mmHg          Heart Rate: 72 bpm       â”‚
â”‚  Temperature: 98.6Â°F                  SpO2: 98%                 â”‚
â”‚                                                                  â”‚
â”‚  CHIEF COMPLAINT                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Patient reports persistent headaches and fatigue for the      â”‚
â”‚  past two weeks.                                                â”‚
â”‚                                                                  â”‚
â”‚  SYMPTOMS                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ Headache                                                     â”‚
â”‚    Location: Frontal | Severity: 6/10 | Duration: 2 weeks      â”‚
â”‚    Notes: Worse in the morning, improves with rest             â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Fatigue                                                      â”‚
â”‚    Location: Generalized | Severity: 5/10 | Duration: 1 month  â”‚
â”‚    Notes: Despite adequate sleep                                â”‚
â”‚                                                                  â”‚
â”‚  DIAGNOSIS                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Tension headache; Vitamin D deficiency suspected               â”‚
â”‚                                                                  â”‚
â”‚  Notes: Recommend lab work to confirm Vitamin D levels.         â”‚
â”‚                                                                  â”‚
â”‚  PRESCRIPTIONS                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  1. Ibuprofen 400mg                                             â”‚
â”‚     Dosage: 1 tablet | Frequency: Every 6 hours as needed      â”‚
â”‚     Duration: 2 weeks | Quantity: 28                           â”‚
â”‚     Instructions: Take with food. Do not exceed 4 tablets in   â”‚
â”‚                   24 hours.                                     â”‚
â”‚                                                                  â”‚
â”‚  2. Vitamin D3 2000 IU                                          â”‚
â”‚     Dosage: 1 capsule | Frequency: Once daily                  â”‚
â”‚     Duration: 90 days | Quantity: 90                           â”‚
â”‚     Instructions: Take with food for better absorption.         â”‚
â”‚                                                                  â”‚
â”‚  TREATMENT PLAN                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  Start Vitamin D supplementation. Use OTC pain relief for      â”‚
â”‚  headaches as needed. Schedule lab work for Vitamin D levels.  â”‚
â”‚  Return in 4 weeks for follow-up.                              â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                  â”‚
â”‚  ___________________________                                    â”‚
â”‚  Provider Signature                    Date: ______________    â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Generated: February 21, 2026 10:45 AM | Record ID: ABC123     â”‚
â”‚  Generated by MedRecord AI                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Export Button on Appointment View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… February 21, 2026  â”‚  Follow-up  â”‚  âœ… Completed            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Edit Record]    [Generate Summary]    [ğŸ“„ Export to PDF]      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Generating State

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚              ğŸ“„ Generating PDF...                               â”‚
â”‚              â•â•â•â•â•â•â•â•â•â•â•â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Design Guidelines

- "Export PDF" button on appointment view page
- Loading indicator during PDF generation
- Download automatically or open in new browser tab
- PDF should fit on standard letter (US) or A4 paper
- Professional, clean formatting
- Consider print-friendly button as alternative
- File naming: `[PatientLastName][PatientFirstName]_[Date]_MedicalRecord.pdf`

---

## Testing Scenarios

| Scenario | Input | Expected Result |
|----------|-------|-----------------|
| Generate PDF | Complete record | PDF downloads with all data |
| Patient info | - | Patient name, DOB, phone in PDF |
| Appointment info | - | Date, type, reason in PDF |
| Vital signs | Recorded | Vitals section in PDF |
| No vital signs | Not recorded | Vitals section omitted |
| Symptoms | 2 symptoms | Both listed with details |
| Prescriptions | 2 prescriptions | Both listed with full info |
| File name | Generate | LastFirstName_YYYY-MM-DD_MedicalRecord.pdf |
| Print layout | Print PDF | Fits on single or minimal pages |
| Generation error | Server error | Error message with retry |

---

## Definition of Done

- [ ] Export PDF button visible on completed appointments
- [ ] PDF includes all patient information
- [ ] PDF includes appointment details
- [ ] PDF includes vital signs (if recorded)
- [ ] PDF includes symptoms with details
- [ ] PDF includes diagnosis
- [ ] PDF includes all prescriptions
- [ ] PDF includes treatment plan
- [ ] Professional formatting achieved
- [ ] PDF downloads correctly
- [ ] Error handling for failures
- [ ] Unit tests pass
- [ ] Manual QA verified with printed output
